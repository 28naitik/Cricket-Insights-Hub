{% extends 'base.html' %}
{% block title %}Community - Cricket Insights Hub{% endblock %}
{% block content %}
<div class="flex flex-col min-h-screen bg-gray-100">
    <!-- Title Section -->
    <section class="py-4 text-center bg-green-700 text-white">
        <h2 class="text-3xl font-bold">Community</h2>
        <p class="text-sm text-gray-200 mt-1">Share your cricket insights and connect with fans!</p>
    </section>

    <!-- Posts Section -->
    <section class="post-list max-w-2xl mx-auto flex-1 px-4 py-6">
        {% for post in posts %}
            <div class="post bg-white border border-gray-200 rounded-xl p-5 mb-6 shadow hover:shadow-md transition">
                <!-- Post Header -->
                <div class="flex justify-between items-start">
                    <div>
                        <p class="text-sm text-gray-500">
                            <span class="font-semibold text-gray-700">{{ post.user.username|default:"Anonymous" }}</span>
                            ¬∑ {{ post.created_at|date:"M j, Y ¬∑ g:i a" }}
                        </p>
                    </div>
                    <!-- Delete Button -->
                    <form method="post" action="{% url 'delete_post' post.id %}" onsubmit="return confirm('Are you sure you want to delete this post?');">
                        {% csrf_token %}
                        <button type="submit" class="text-red-500 text-xl hover:text-red-600" title="Delete Post">üóëÔ∏è</button>
                    </form>
                </div>

                <!-- Post Content -->
                <div class="mt-3 text-gray-800 whitespace-pre-line">{{ post.content }}</div>

                <!-- Post Image -->
                {% if post.image %}
                    <img src="{{ post.image.url }}" alt="Post image" class="mt-3 rounded-lg border max-w-full h-auto">
                {% endif %}

                <!-- Like Section -->
                <div class="flex items-center mt-3 space-x-4 text-sm">
                    <span class="text-blue-600">‚ù§Ô∏è {{ post.likes }}</span>
                    <a href="{% url 'like_post' post.id %}" class="text-blue-600 hover:underline">Like</a>
                </div>

                <!-- Comment Form -->
                <form method="post" class="mt-4 bg-gray-50 border rounded-lg p-3">
                    {% csrf_token %}
                    <input type="hidden" name="post_id" value="{{ post.id }}">
                    {{ comment_form.text }}
                    <button type="submit" name="submit_comment" class="mt-2 bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700">Comment</button>
                </form>

                <!-- Display Comments -->
                <div class="mt-4 pl-3">
                    {% for comment in post.comments.all %}
                        <div class="comment text-gray-700 text-sm mb-2 border-l-4 border-gray-300 pl-2">üí¨ {{ comment.text }}</div>
                    {% empty %}
                        <div class="text-gray-500 text-sm">No comments yet.</div>
                    {% endfor %}
                </div>
            </div>
        {% empty %}
            <p class="text-gray-500 text-center">No posts yet. Be the first to share something!</p>
        {% endfor %}
    </section>

    <!-- Post Creation Form -->
    <section class="post-box w-full bg-white border-t border-gray-300 py-4 px-4 sticky bottom-0 shadow-md">
        <form method="post" enctype="multipart/form-data" class="flex flex-col sm:flex-row items-start sm:items-center max-w-5xl mx-auto space-y-3 sm:space-y-0 sm:space-x-4">
            {% csrf_token %}
            <textarea name="content" class="w-full sm:flex-1 rounded-lg border-gray-300 p-3 resize-none" rows="3" placeholder="What's happening in cricket?">{{ post_form.content.value|default_if_none:"" }}</textarea>
            <div class="flex flex-col space-y-2">
                {{ post_form.image }}
                <button type="submit" name="submit_post" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">Post</button>
            </div>
        </form>
        {% if post_form.content.errors %}
            <p class="text-red-600 text-sm mt-2">{{ post_form.content.errors }}</p>
        {% endif %}
    </section>
</div>

<style>
    .post-box textarea {
        border: 1px solid #d1d5db;
        border-radius: 8px;
        padding: 10px;
        width: 100%;
        resize: vertical;
        min-height: 60px;
        max-height: 100px;
    }
    .post-box input[type="file"] {
        font-size: 0.875rem;
    }
</style>
{% endblock %}
